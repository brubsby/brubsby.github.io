<html>
  <head>
  <meta name="title" content="brubsby">
  <meta name="description" content="a personal computer art website for brubsby">
  <meta name="keywords" content="generative, art, generative art, algorithm, algorithms, brubsby, computational, javascript, mathematics">
  <meta name="robots" content="index, follow">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="language" content="English">

  <title>brubsby</title>

  <style>
  body {
    background: #fff;
    font-size: 20px;
    font-family: Courier, monospace;
    color: #000;
  	padding: 2em 3em 2em 3em;
    display: grid;
    grid-template-columns: min-content auto;
    grid-template-rows: 100%;
  }
  div {
  	font-weight: normal;
  }
  ol, li {
    list-style-type: none;
    padding-left: 8px;
  }
  div.head {
    margin: 0;
    font-size: 3em;
    grid-column: 1 / 1;
  }
  div.ascii {
    margin-left: 68px;
    vertical-align: top;
    grid-column: 2 / 2;
  }
  a {
    text-decoration: none;
  }
  </style>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-152720878-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-152720878-1');
  </script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/2.3.10/seedrandom.min.js"></script>
  <script src="js/simplex-noise.js"></script>
  <script>
  /*----------- Global init -----------*/
  var canvas, flat_index_list, simplex_noise, rows, columns,
    animation_speed_multiplier, min_dim, max_dim, flat_mapgen_tiles,
    mapgen_tiles, mapgen_probabilities, falloff_map, velocity_pixels,
    position_pixels, bounces;
  var frame_count = 0;
  var char_height = 23;
  var char_width = 12.003;
  var index_lists = [];


  /*----------- Helper Functions -----------*/
  var init_flat_index_list = (rows, columns, sort_func=null) => {
      if (!flat_index_list) {
        flat_index_list = [];
        for (var i = 0; i < (columns + 1) * rows - 1; i++) {
          if (i % (columns + 1) == columns) continue;
          flat_index_list.push(i);
        }
        if (sort_func) {
          flat_index_list.sort(sort_func)
        }
      }
  };
  var init_simplex_noise = () => {
      if (!simplex_noise) {
        simplex_noise = new SimplexNoise(Math.random().toString());
      }
  };
  var init_mapgen_tiles = () => {
      if (!mapgen_tiles) {
        // ≈.,`ⁿ⌠τ↑♠n∩⌂▲
        mapgen_tiles = ['≈', [',', '.', '`'], '∩', '⌂', '▲'];
        flat_mapgen_tiles = [];
        for (var i = 0; i < mapgen_tiles.length; i++) {
          if (Array.isArray(mapgen_tiles[i])) {
            flat_mapgen_tiles.push(mapgen_tiles[i][Math.floor(Math.random() * mapgen_tiles[i].length)]);
          } else {
            flat_mapgen_tiles.push(mapgen_tiles[i]);
          }
        }
      }
  };
  var init_falloff_map = (rows, columns, char_width, char_height) => {
      if (!falloff_map) {
        falloff_map = (coords) => {
          var width = columns * char_width;
          var height = rows * char_height;
          var x = (coords[0] / width) * 2 - 1;
          var y = (coords[1] / height) * 2 - 1;
          var value = Math.max(Math.abs(x), Math.abs(y));
          var a = 3;
          var b = 2.2;
          value = Math.pow(value, a) / (Math.pow(value, a) + Math.pow((b - b * value), a))
          return value;
        }
      }
  };
  var get_canvas_index = (columns, x, y) => { return x + y * (columns + 1); };
  var get_coords = (columns, index) => { return [index % (columns + 1), Math.floor(index / (columns + 1))];};
  var get_pixel_coords = (columns, index, char_width, char_height) => {
    var coords = get_coords(columns, index);
    return [coords[0] * char_width, coords[1] * char_height];
  }
  var get_simplex_noise_at = (coords, frequency, amplitude, octaves=1, lacunarity=2, gain=0.5) => {
    var octave_amplitude = amplitude;
    var octave_frequency = frequency;
    var result = 0;
    for (var i = 0; i < octaves; i++) {
      result += octave_amplitude * simplex_noise.noise2D(octave_frequency * coords[0], octave_frequency * coords[1]);
      octave_amplitude *= gain;
      octave_frequency *= lacunarity;
    }
    return result;
  }
  var setCharAt = (canvas,index,chr) => {
    var str = canvas.text();
    if(index > str.length-1) return str;
    var new_str = str.substr(0,index) + chr + str.substr(index+1);
    canvas.text(new_str);
  };
  var getCharAt = (canvas,index) => {
    return canvas.text().charAt(index);
  };
  var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;
    for (i = 0; i < sURLVariables.length; i++) {
      sParameterName = sURLVariables[i].split('=');
      if (sParameterName[0] === sParam) {
        return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
      }
    }
  };
  var isInt = (a) => { return (typeof a==='number' && (a%1)===0); };


  /*----------- Animations -----------*/
  var animations = [
    // . to o random
    () => {
      init_flat_index_list(rows, columns);
      for (var n = 0; n < animation_speed_multiplier; n++) {
        var index = Math.floor(Math.random() * flat_index_list.length);
        setCharAt(canvas, flat_index_list[index], "o");
        flat_index_list.splice(index, 1);
        if (flat_index_list.length <= 0) {
          return;
        }
      }
      setTimeout(animations[0], 0);
    },
    // random hex wipe
    () => {
      init_flat_index_list(rows, columns);
      var random_hex_char = Math.floor(Math.random() * 16).toString(16);
      setCharAt(canvas, flat_index_list[0], random_hex_char);
      flat_index_list.shift();
      if (flat_index_list.length <= 0) {
        return;
      }
      setTimeout(animations[1], 0);
    },
    // 10 print up or down
    () => {
      var isupdown = constant_random_boolean;
      var y = frame_count;
      for (var x = 0; x < columns; x++) {
        var index = get_canvas_index(columns, x, isupdown ? rows - y : y);
        var random_slash = ['/', '\\'][Math.floor(Math.random()*2)];
        setCharAt(canvas, index, random_slash);
      }
      if (frame_count >= rows) return;
      frame_count++
      setTimeout(animations[2], 50);
    },
    // growing circle / entombing circle
    () => {
      init_flat_index_list(rows, columns);
      var isminmax = constant_random_boolean;
      var center_x = columns / 2;
      var center_y = rows / 2;
      for (var n = 0; n < animation_speed_multiplier; n++) {
        var minmax_dist = 9999999 * (isminmax ? 1 : -1);
        var minmax_dist_index = -1;
        for (var i = 0; i < flat_index_list.length; i++) {
          var coords = get_coords(columns, flat_index_list[i]);
          var dist = Math.sqrt(Math.pow((center_x - coords[0]) * char_width, 2) + Math.pow((center_y - coords[1]) * char_height, 2))
          if (isminmax && dist < minmax_dist || !isminmax && dist > minmax_dist) {
            minmax_dist = dist;
            minmax_dist_index = i;
          }
        }
        setCharAt(canvas, flat_index_list[minmax_dist_index], "o");
        flat_index_list.splice(minmax_dist_index, 1);
        if (flat_index_list.length <= 0) {
          return;
        }
      }
      setTimeout(animations[3], 0);
    },
    // entombing triangles
    () => {
      init_flat_index_list(rows, columns);
      var theta = constant_random_values[0] * Math.PI * 2;
      var a = Math.cos(theta);
      var b = Math.sin(theta);
      var c = constant_random_values[0] * 100000;
      for (var n = 0; n < animation_speed_multiplier; n++) {
        var min_dist = 9999999;
        var max_dist = -9999999;
        var min_dist_index = -1;
        var max_dist_index = -1;
        for (var i = 0; i < flat_index_list.length; i++) {
          var coords = get_coords(columns, flat_index_list[i]);
          var pixel_coords = [coords[0] * char_width, coords[1] * char_height];
          var dist = Math.abs(a * pixel_coords[0] + b * pixel_coords[1] + c) / Math.sqrt(Math.pow(a, 2) + Math.pow(b, 2));
          if (dist < min_dist) {
            min_dist = dist;
            min_dist_index = i;
          }
          if (dist > max_dist) {
            max_dist = dist;
            max_dist_index = i;
          }
        }
        setCharAt(canvas, flat_index_list[min_dist_index], "o");
        setCharAt(canvas, flat_index_list[max_dist_index], "o");
        flat_index_list.splice(max_dist_index, 1);
        if (max_dist_index != min_dist_index) {
          if (max_dist_index < min_dist_index) {
            flat_index_list.splice(min_dist_index - 1, 1);
          } else {
            flat_index_list.splice(min_dist_index, 1);
          }
        }
        if (flat_index_list.length <= 0) {
          return;
        }
      }
      setTimeout(animations[4], 0);
    },
    // growing heart / entombing heart
    () => {
      init_flat_index_list(rows, columns);
      var isminmax = constant_random_boolean;
      var center_x = columns / 2;
      var center_y = rows / 4 - (frame_count * 0.0001);
      var heart_multiplier = isminmax ? 2 : 45 * (animation_speed_multiplier + 2);
      var pixels_changed = 0;
      var tries = 0;
      while (pixels_changed < animation_speed_multiplier * 10) {
        frame_count++;
        var minmax_dist = 9999999 * (isminmax ? 1 : -1);
        var minmax_dist_index = -1;
        for (var i = 0; i < flat_index_list.length; i++) {
          var coords = get_coords(columns, flat_index_list[i]);
          var dist = Math.sqrt(Math.pow((coords[0] - center_x) * char_width, 2) + Math.pow((coords[1] - center_y) * char_height, 2))
          var theta = Math.atan2((center_y - coords[1]) * char_height, (center_x - coords[0]) * char_width);
          var heart_radius =
            heart_multiplier * (2 - 2 * Math.sin(theta) + Math.sin(theta)
            * (Math.sqrt(Math.abs(Math.cos(theta))) / (Math.sin(theta) + 1.4)));
          if (isminmax && dist < minmax_dist && dist < heart_radius || !isminmax && dist > minmax_dist && dist > heart_radius) {
            minmax_dist = dist;
            minmax_dist_index = i;
          }
        }
        if (minmax_dist_index == -1) {
          tries++;
          if (tries > 1000) {
            while (true) {
              setCharAt(canvas, flat_index_list[0], "o");
              flat_index_list.shift();
              if (flat_index_list.length <= 0) {
                return;
              }
            }
          }
          heart_multiplier += 3 * (isminmax ? 1 : -1);
          continue;
        }
        setCharAt(canvas, flat_index_list[minmax_dist_index], "o");
        pixels_changed++;
        flat_index_list.splice(minmax_dist_index, 1);
        if (flat_index_list.length <= 0) {
          return;
        }
      }
      setTimeout(animations[5], 0);
    },
    // simplex growth
    () => {
      var simplex_frequency = animation_speed_multiplier * -0.0001635 + 0.00237;
      var simplex_amplitude = 1;
      var octaves = Math.floor(constant_random_values[0] * Math.min(animation_speed_multiplier - 1, 3)) + 1;
      init_simplex_noise();
      init_flat_index_list(rows, columns, (index1, index2) => {
        var coords1 = get_pixel_coords(columns, index1, char_width, char_height);
        var coords2 = get_pixel_coords(columns, index2, char_width, char_height);
        return get_simplex_noise_at(coords1, simplex_frequency, simplex_amplitude, octaves)
        - get_simplex_noise_at(coords2, simplex_frequency, simplex_amplitude, octaves);
      });
      for (var n = 0; n < animation_speed_multiplier; n++) {
        setCharAt(canvas, flat_index_list[0], "o");
        flat_index_list.shift();
        if (flat_index_list.length <= 0) {
          return;
        }
      }
      setTimeout(animations[6], 0);
    },
    // mapgen
    () => {
      var isisland = constant_random_boolean;
      var frequency = animation_speed_multiplier * -0.0001635 + 0.00237;
      var amplitude = 1;
      var octaves = Math.floor(Math.min(animation_speed_multiplier - 1, 3)) + 1;
      var lacunarity = 2;
      var gain = 0.5;
      var pixels_changed = 0;
      init_falloff_map(rows, columns, char_width, char_height);
      init_simplex_noise();
      init_mapgen_tiles();
      var value_at = (coords) => {
        var value = get_simplex_noise_at(coords, frequency, amplitude, octaves, lacunarity, gain);
        if (isisland) {
          value -= falloff_map(coords);
        }
        return value;
      }
      init_flat_index_list(rows, columns, (index1, index2) => {
        var coords1 = get_pixel_coords(columns, index1, char_width, char_height);
        var coords2 = get_pixel_coords(columns, index2, char_width, char_height);
        return value_at(coords1)
        - value_at(coords2);
      });
      if (!mapgen_probabilities) {
        mapgen_probabilities = [];
        var max_amplitude = amplitude * (Math.pow(gain, octaves) - 1) / (gain - 1);
        mapgen_probabilities.push(max_amplitude);
        mapgen_probabilities.push(-0.15);
        for (var i = 0; i < flat_mapgen_tiles.length - 2; i++) {
          mapgen_probabilities.push((i + 1) * amplitude / (flat_mapgen_tiles.length - 1));
        }
        mapgen_probabilities.sort();
        for (var i = 0; i < flat_mapgen_tiles.length; i++) {
          index_lists.push([]);
        }
        var current_noise;
        var current_tile_index = 0;
        for (var i = 0; i < flat_index_list.length; i++) {
          current_coords = get_pixel_coords(columns, flat_index_list[i], char_width, char_height);
          current_noise = value_at(current_coords);
          for (var j = 0; j <= current_tile_index; j++) {
            index_lists[j].push(flat_index_list[i]);
          }
          if (current_noise > mapgen_probabilities[current_tile_index]) {
            current_tile_index = Math.min(current_tile_index + 1, flat_mapgen_tiles.length - 1);
          }
        }
      }
      var any_pixels = false;
      for (var i = 0; i < index_lists.length; i++) {
        while(index_lists[i].length > 0 && pixels_changed < animation_speed_multiplier * 4) {
          setCharAt(canvas, index_lists[i][0], flat_mapgen_tiles[i]);
          index_lists[i].shift();
          pixels_changed++;
          any_pixels = true;
        }
      }
      if (!any_pixels) return;
      setTimeout(animations[7], 0);
    },
    // dvd ball
    () => {
      var width = columns * char_width;
      var height = rows * char_height;
      var ball_radius_pixels = Math.min((Math.min(width, height) / 3), constant_random_values[0] * Math.max(25, max_dim) + 75);
      if (frame_count == 0) {
        bounces = 0;
        var ball_speed = Math.min(Math.random(), Math.random(), Math.random()) * Math.min(Math.min(width, height) - 2 * ball_radius_pixels, 50);
        var theta = Math.random() * 2 * Math.PI;
        velocity_pixels = [ball_speed * Math.cos(theta), ball_speed * Math.sin(theta)];
        position_pixels = [Math.random() * (width - 2 * ball_radius_pixels) + ball_radius_pixels,
          Math.random() * (height - 2 * ball_radius_pixels) + ball_radius_pixels];
      }
      var ball_coords = [];
      var min_x = Math.max(0, Math.floor(-1 + (position_pixels[0] - ball_radius_pixels) / char_width));
      var max_x = Math.min(columns, Math.floor(1 + (position_pixels[0] + ball_radius_pixels) / char_width));
      var min_y = Math.max(0, Math.floor(-1 + (position_pixels[1] - ball_radius_pixels) / char_height));
      var max_y = Math.min(rows, Math.floor(1 + (position_pixels[1] + ball_radius_pixels) / char_height));
      for (var i = min_x; i < max_x; i++) {
        for (var j = min_y; j < max_y; j++) {
          var x_pixels = (i + 0.5) * char_width;
          var y_pixels = (j + 0.5) * char_height;
          if (Math.sqrt(Math.pow(x_pixels - position_pixels[0], 2) + Math.pow(y_pixels - position_pixels[1], 2)) <= ball_radius_pixels) {
            ball_coords.push([i, j]);
          }
        }
      }
      var text = (".".repeat(columns) + "\n").repeat(rows);
      for (var i = 0; i < ball_coords.length; i++) {
        var index = get_canvas_index(columns, ball_coords[i][0], ball_coords[i][1]);
        text = text.substr(0, index) + "o" + text.substr(index + 1);
      }
      canvas.text(text);

      position_pixels = [position_pixels[0] + velocity_pixels[0],
        position_pixels[1] + velocity_pixels[1]];
      if (bounces < 100) {
        if (position_pixels[0] < ball_radius_pixels) {
          velocity_pixels[0] *= -1;
          position_pixels[0] += 2 * (ball_radius_pixels - position_pixels[0]);
          bounces++;
        } else if (position_pixels[0] > width - ball_radius_pixels) {
          velocity_pixels[0] *= -1;
          position_pixels[0] -= 2 * (position_pixels[0] + ball_radius_pixels - width);
          bounces++;
        }
        if (position_pixels[1] < ball_radius_pixels) {
          velocity_pixels[1] *= -1;
          position_pixels[1] += 2 * (ball_radius_pixels - position_pixels[1]);
          bounces++;
        } else if (position_pixels[1] > height - ball_radius_pixels) {
          velocity_pixels[1] *= -1;
          position_pixels[0] -= 2 * (position_pixels[1] + ball_radius_pixels - height);
          bounces++;
        }
      } else {
        if (position_pixels[0] < -ball_radius_pixels
          || position_pixels[1] < -ball_radius_pixels
          || position_pixels[0] > width + ball_radius_pixels
          || position_pixels[1] > height + ball_radius_pixels) {
          return;
        }
      }


      frame_count++;
      setTimeout(animations[8], 0);
    }
  ];

  /*----------- Random/Seed init -----------*/
  var animation_index;
  var animation_url_param = getUrlParameter("a");
  var parsed = parseInt(animation_url_param, 10);
  if (!isNaN(parsed)) animation_index = parsed;
  if (animation_index === 0 || !!animation_index) {
    if (animation_index >= animations.length) {
      Math.seedrandom(animation_index);
      animation_index = null;
    }
  } else if (!!animation_url_param) {
    Math.seedrandom(animation_url_param);
  }

  var constant_random_boolean = Math.random() < 0.5;
  var constant_random_values = [];
  for (var i = 0; i < 10; i++) {
    constant_random_values.push(Math.random());
  }

  var animation = animations[animation_index === 0 ? 0 : (animation_index || (Math.floor(Math.random() * animations.length)))];

  $(document).ready(function() {
    reset_canvas();

    setTimeout(animation, 200);
  });

  var reset_canvas = function() {
      canvas = $(".ascii");
      var width = canvas.width();
      var height = canvas.height();

      rows = Math.max(1, Math.floor(height / char_height));
      columns = Math.max(1, Math.floor(width / char_width));
      animation_speed_multiplier = Math.max(1, Math.floor(rows * columns / 1000));
      max_dim = Math.max(1, Math.max(rows, columns));
      min_dim = Math.max(1, Math.min(rows, columns));
      var row_text = ".".repeat(columns);

      canvas.empty();
      for (var i = 0; i < rows; i++) {
        canvas.append(row_text + "\n");
      }
  }


  </script>
  </head>
  <body>
    <div class="menu">
      <div class="head">BRUBSBY</div>
      <ol id="links">
        <li id="twitter"><a href="https://twitter.com/brubsby">TWITTER</a></li>
        <li id="art"><a href="https://twitter.com/search?q=(%23plottertwitter%20OR%20%23generative)%20(from%3Abrubsby)&src=typed_query">ART</a></li>
        <li id="support"><a href="https://ko-fi.com/brubsby">SUPPORT</a></li>
        <li id="inquiries"><a href="https://twitter.com/messages/compose?recipient_id=2402350662">INQUIRIES</a></li>
      </ol>
    </div>
    <div class="ascii"></div>
  </body>
</html>
