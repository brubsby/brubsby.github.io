<html>
  <head>
  <meta name="title" content="brubsby">
  <meta name="description" content="a personal computer art website for brubsby">
  <meta name="keywords" content="generative, art, generative art, algorithm, algorithms, brubsby, computational, javascript, mathematics">
  <meta name="robots" content="index, follow">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="language" content="English">

  <title>brubsby</title>

  <style>
  body {
    background: #fff;
    font-size: 20px;
    font-family: Courier, monospace;
    color: #000;
  	padding: 2em 3em 2em 3em;
    display: grid;
    grid-template-columns: min-content auto;
    grid-template-rows: 100%;
  }
  div {
  	font-weight: normal;
  }
  ol, li {
    list-style-type: none;
    padding-left: 8px;
  }
  div.head {
    margin: 0;
    font-size: 3em;
    grid-column: 1 / 1;
  }
  div.ascii {
    margin-left: 68px;
    vertical-align: top;
    grid-column: 2 / 2;
  }
  a {
    text-decoration: none;
  }
  </style>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-152720878-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-152720878-1');
  </script>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/2.3.10/seedrandom.min.js"></script>
  <script>
  var canvas, flat_index_list, rows, columns;
  var frame_count = 0;
  var char_height = 23;
  var char_width = 12.003;
  var init_flat_index_list = (rows, columns) => {
      if (!flat_index_list) {
        flat_index_list = [];
        for (var i = 0; i < (columns + 1) * rows - 1; i++) {
          if (i % (columns + 1) == columns) continue;
          flat_index_list.push(i);
        }
      }
  };
  var get_canvas_index = (columns, x, y) => { return x + y * (columns + 1); };
  var get_coords = (columns, index) => { return [index % (columns + 1), Math.floor(index / (columns + 1))];};
  var setCharAt = (canvas,index,chr) => {
    var str = canvas.text();
    if(index > str.length-1) return str;
    var new_str = str.substr(0,index) + chr + str.substr(index+1);
    canvas.text(new_str);
  };
  var getCharAt = (canvas,index) => {
    return canvas.text().charAt(index);
  };
  var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;
    for (i = 0; i < sURLVariables.length; i++) {
      sParameterName = sURLVariables[i].split('=');
      if (sParameterName[0] === sParam) {
        return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
      }
    }
  };
  var isInt = (a) => { return (typeof a==='number' && (a%1)===0); };
  var animations = [
    // . to o random
    () => {
      var x, y, index, tries = 0;
      var max_tries = 100000;
      do {
          x = Math.floor(Math.random() * columns);
          y = Math.floor(Math.random() * rows);
          index = get_canvas_index(columns, x, y);
          tries++;
      }
      while (getCharAt(canvas, index) == "o" && tries < max_tries);
      if (tries >= max_tries) return;
      setCharAt(canvas, index, "o");
      setTimeout(animations[0], 0);
    },
    // random hex wipe
    () => {
      var x = frame_count % columns;
      var y = Math.floor(frame_count / columns);
      var index = get_canvas_index(columns, x, y);
      var random_hex_char = Math.floor(Math.random() * 16).toString(16);
      setCharAt(canvas, index, random_hex_char);
      frame_count++
      setTimeout(animations[1], 0);
    },
    // 10 print up or down
    () => {
      var isupdown = constant_random_boolean;
      var y = frame_count;
      for (var x = 0; x < columns; x++) {
        var index = get_canvas_index(columns, x, isupdown ? rows - y : y);
        var random_slash = ['/', '\\'][Math.floor(Math.random()*2)];
        setCharAt(canvas, index, random_slash);
      }
      if (frame_count >= rows) return;
      frame_count++
      setTimeout(animations[2], 50);
    },
    // growing circle / entombing circle
    () => {
      init_flat_index_list(rows, columns);
      var isminmax = constant_random_boolean;
      var center_x = columns / 2;
      var center_y = rows / 2;
      var minmax_dist = 9999999 * (isminmax ? 1 : -1);
      var minmax_dist_index = -1;
      for (var i = 0; i < flat_index_list.length; i++) {
        var coords = get_coords(columns, flat_index_list[i]);
        var dist = Math.sqrt(Math.pow((center_x - coords[0]) * char_width, 2) + Math.pow((center_y - coords[1])  * char_height, 2))
        if (isminmax && dist < minmax_dist || !isminmax && dist > minmax_dist) {
          minmax_dist = dist;
          minmax_dist_index = i;
        }
      }
      setCharAt(canvas, flat_index_list[minmax_dist_index], "o");
      flat_index_list.splice(minmax_dist_index, 1);
      if (flat_index_list.length <= 0) {
        return;
      }
      setTimeout(animations[3], 0);
    },
    // entombing triangles
    () => {
      init_flat_index_list(rows, columns);
      var min_dist = 9999999;
      var max_dist = -9999999;
      var min_dist_index = -1;
      var max_dist_index = -1;
      var theta = constant_random_values[0] * Math.PI * 2;
      var a = Math.cos(theta);
      var b = Math.sin(theta);
      var c = constant_random_values[0] * 100000;
      for (var i = 0; i < flat_index_list.length; i++) {
        var coords = get_coords(columns, flat_index_list[i]);
        var pixel_coords = [coords[0] * char_width, coords[1] * char_height];
        var dist = Math.abs(a * pixel_coords[0] + b * pixel_coords[1] + c) / Math.sqrt(Math.pow(a, 2) + Math.pow(b, 2));
        if (dist < min_dist) {
          min_dist = dist;
          min_dist_index = i;
        }
        if (dist > max_dist) {
          max_dist = dist;
          max_dist_index = i;
        }
      }
      setCharAt(canvas, flat_index_list[min_dist_index], "o");
      setCharAt(canvas, flat_index_list[max_dist_index], "o");
      flat_index_list.splice(max_dist_index, 1);
      if (max_dist_index != min_dist_index) {
        if (max_dist_index < min_dist_index) {
          flat_index_list.splice(min_dist_index - 1, 1);
        } else {
          flat_index_list.splice(min_dist_index, 1);
        }
      }
      if (flat_index_list.length <= 0) {
        return;
      }
      setTimeout(animations[4], 0);
    }
  ];

  /**
    seed based on url param and generate randomness
  **/
  var animation_index;
  var animation_url_param = getUrlParameter("a");
  var parsed = parseInt(animation_url_param, 10);
  if (!isNaN(parsed)) animation_index = parsed;
  if (animation_index === 0 || !!animation_index) {
    if (animation_index >= animations.length) {
      Math.seedrandom(animation_index);
      animation_index = null;
    }
  } else if (!!animation_url_param) {
    Math.seedrandom(animation_url_param);
  }

  var constant_random_boolean = Math.random() < 0.5;
  var constant_random_values = [];
  for (var i = 0; i < 10; i++) {
    constant_random_values.push(Math.random());
  }

  var animation = animations[animation_index === 0 ? 0 : (animation_index || (Math.floor(Math.random() * animations.length)))];

  $(document).ready(function() {
    reset_canvas();

    setTimeout(animation, 100);
  });

  var reset_canvas = function() {
      canvas = $(".ascii");
      var width = canvas.width();
      var height = canvas.height();

      rows = Math.max(1, Math.floor(height / char_height));
      columns = Math.max(1, Math.floor(width / char_width));
      var row_text = ".".repeat(columns);

      canvas.empty();
      for (var i = 0; i < rows; i++) {
        canvas.append(row_text + "\n");
      }
  }


  </script>
  </head>
  <body>
    <div class="menu">
      <div class="head">BRUBSBY</div>
      <ol id="links">
        <li id="twitter"><a href="https://twitter.com/brubsby">TWITTER</a></li>
        <li id="art"><a href="https://twitter.com/search?q=(%23plottertwitter%20OR%20%23generative)%20(from%3Abrubsby)&src=typed_query">ART</a></li>
        <li id="support"><a href="https://ko-fi.com/brubsby">SUPPORT</a></li>
        <li id="inquiries"><a href="https://twitter.com/messages/compose?recipient_id=2402350662">INQUIRIES</a></li>
      </ol>
    </div>
    <div class="ascii"></div>
  </body>
</html>
