<html>
  <head>
  <meta name="title" content="brubsby">
  <meta name="description" content="computer art brubfolio">
  <meta name="keywords" content="brubsby, computer art, generative art, plotter art">
  <meta name="robots" content="index, follow">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="language" content="English">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">

  <title>brubsby</title>

  <style>

  @font-face {
    font-family: 'DF';
    src: url('assets/LessPerfectDOSVGA.woff') format('woff'), /* Chrome 6+, Firefox 3.6+, IE 9+, Safari 5.1+ */
     url('assets/LessPerfectDOSVGA.ttf') format('truetype'); /* Chrome 4+, Firefox 3.5, Opera 10+, Safari 3—5 */
  }

  @media (orientation: landscape) {
    div.ascii {
      grid-area: 1 / 2 / span 2 / span 1;
    }
  }

  @media (orientation: portrait) {
    div.ascii {
      grid-area: 2 / 1 / span 1 / span 2;
    }
  }

  body {
    background: #fff;
    font-size: 20px;
    font-family: Courier, monospace;
    color: #000;
  	padding: 2em 3em 2em 3em;
  }

  div.container {
    display: grid;
    grid-column-gap: 68px;
    grid-row-gap: 10px;
    grid-template-columns: min-content auto;
    grid-template-rows: min-content auto;
    height: 100%;
  }
  div {
  	font-weight: normal;
  }
  ol, li {
    list-style-type: none;
    padding-left: 8px;
  }
  div.menu {
    margin: 0;
    grid-column: 1 / 1;
  }
  h1 {
    margin: 0;
    font-weight: normal;
    style: none;
    font-size: 3em;
  }
  div.ascii {
    vertical-align: top;
    white-space: pre;
    line-height: 1;
    font-size: 24px;
    font-family: "DF", monospace;
  }
  a {
    text-decoration: none;
    color: black;
  }
  li:hover {
    text-decoration: underline;
  }
  </style>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-152720878-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-152720878-1');
  </script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/2.3.10/seedrandom.min.js"></script>
  <script src="js/simplex-noise.js"></script>
  <script>
  /*----------- Class Definitions -----------*/
  class ObjectSampler {
    constructor() {this.objects=[];this.total_weight=0;return this;}
    put(obj, weight=1) {
      this.total_weight+=weight;
      this.objects.push({"obj":obj,"weight":weight,"total_weight":this.total_weight});
      return this;
    };
    uniform_sample() {return this.objects[Math.floor(this.objects.length * Math.random())]["obj"];}
    sample() {
      var index_val = this.total_weight * Math.random();
      for (var i = 0; i < this.objects.length; i++) {
        if (index_val < this.objects[i]["total_weight"]) return this.objects[i]["obj"];
      }
      throw "sample error, random value was " + index_val + " but total weight was " + this.total_weight;
    }
    get_index(i) {return this.objects[i]["obj"];}
    size() {return this.objects.length;}
  }

  class SortedSet {
    constructor(array = [], compare=() => {if (a === b) return 0; return a < b ? -1 : 1;}) {
        if (typeof array === 'function') { compare = array; array = []; }
        this._array = []; this.compare = compare;
        const length = array.length; let index = 0;
        while (index < length) { this.add(array[index++]); }
    }
    get size() { return this._array.length; }
    [Symbol.iterator]() { return this._array[Symbol.iterator](); }
    clear() { this._array = []; return this; }
    add(element) { let high = this._array.length; let low = 0;
        while (high > low) {
            const index = Math.floor((high + low) / 2);
            const ordering = this.compare(this._array[index], element);
            if (ordering < 0) { low = index + 1; }
            else if (ordering > 0) { high = index } else { return this; }
        }
        this._array.splice(low, 0, element); return this; }
    has(element) { return this.indexOf(element) !== -1; }
    indexOf(element) { let high = this._array.length; let low = 0;
      while (high > low) {
            const index = Math.floor((high + low) / 2);
            const ordering = this.compare(this._array[index], element);
            if (ordering < 0) { low = index + 1; }
            else if (ordering > 0) { high = index; }
            else { return index; }} return -1;}
    delete(element) {
        const index = this.indexOf(element);
        if (index === -1) { return; }
        const removed = this._array[index]; this._array.splice(index, 1);
        return removed; }
    pop_index(index) {
        const removed = this._array[index]; this._array.splice(index, 1);
        return removed; }
    get_index(index) { return this._array[index]; }
}

  class Particle {
    constructor(position) {
      this.position = position;
      this.velocity = [0, 0];
      this.framecount = 0;
    }
    step(acceleration, timestep) {
      this.framecount++;
      this.velocity = [this.velocity[0] + acceleration[0] * timestep,
        this.velocity[1] + acceleration[1] * timestep];
      this.position = [this.position[0] + this.velocity[0] * timestep,
        this.position[1] + this.velocity[1] * timestep];
    }
    inbounds(width, height) {
      return this.position[0] > 0 && this.position[0] < width
        && this.position[1] > 0 && this.position[1] < height;
    }
    framecount_under(test_value) {
      return this.framecount < test_value;
    }
  }

  /*----------- Global init -----------*/
  var canvas, flat_index_list, simplex_noise, rows, columns,
    animation_speed_multiplier, min_dim, max_dim, flat_mapgen_tiles,
    mapgen_tiles, mapgen_probabilities, falloff_map, velocity_pixels,
    position_pixels, bounces, text_to_print, flip, line_points, last_points,
    empty_half_pixels, browser_info, remaining_particles, particles,
    random_edge_point_sampler;
  var char_height = 24;
  var half_char_height = char_height / 2;
  var char_width = 12;
  var frame_count = 0;
  var index_lists = [];


  /*----------- Helper Functions -----------*/
  var init_flat_index_list = (rows, columns, sort_func=null) => {
      if (!flat_index_list) {
        flat_index_list = [];
        for (var i = 0; i < (columns + 1) * rows - 1; i++) {
          if (i % (columns + 1) == columns) continue;
          flat_index_list.push(i);
        }
        if (sort_func) {
          flat_index_list.sort(sort_func)
        }
      }
  };
  var init_simplex_noise = () => {
      if (!simplex_noise) {
        simplex_noise = new SimplexNoise(Math.random().toString());
      }
  };
  var init_mapgen_tiles = () => {
      if (!mapgen_tiles) {
        // drop ttf into fontdrop.info for codepoints
        // ≈.,`ⁿ⌠τ↑♠ⁿ∩⌂▲ΔΛп
        mapgen_tiles = ['≈', '.', ',', '∩', '\u007F', '\u001E'];
        flat_mapgen_tiles = [];
        for (var i = 0; i < mapgen_tiles.length; i++) {
          if (Array.isArray(mapgen_tiles[i])) {
            flat_mapgen_tiles.push(mapgen_tiles[i][Math.floor(Math.random() * mapgen_tiles[i].length)]);
          } else {
            flat_mapgen_tiles.push(mapgen_tiles[i]);
          }
        }
      }
  };
  var init_falloff_map = (rows, columns, char_width, char_height) => {
      if (!falloff_map) {
        falloff_map = (coords) => {
          var width = columns * char_width;
          var height = rows * char_height;
          var x = (coords[0] / width) * 2 - 1;
          var y = (coords[1] / height) * 2 - 1;
          var value = Math.max(Math.abs(x), Math.abs(y));
          var a = 3;
          var b = 2.2;
          value = Math.pow(value, a) / (Math.pow(value, a) + Math.pow((b - b * value), a))
          return value;
        }
      }
  };
  var get_ascii_char_from_canvas_index = (ascii_art, canvas_columns, canvas_rows, canvas_index) => {
    var ascii_width = ascii_art[0].length;
    var ascii_height = ascii_art.length;
    var ascii_midpoint = [Math.floor(ascii_width / 2), Math.floor(ascii_height / 2)];
    var canvas_midpoint = [Math.floor(canvas_columns / 2), Math.floor(canvas_rows / 2)];
    var canvas_coords = get_coords(canvas_columns, canvas_index);
    var ascii_x = canvas_coords[0] - canvas_midpoint[0] + ascii_midpoint[0];
    var ascii_y = canvas_coords[1] - canvas_midpoint[1] + ascii_midpoint[1];
    ascii_x = Math.min(Math.max(0, ascii_x), ascii_width - 1);
    ascii_y = Math.min(Math.max(0, ascii_y), ascii_height - 1);
    return ascii_art[ascii_y][ascii_x];
  }
  var get_canvas_index = (columns, x, y) => { return x + y * (columns + 1); };
  var get_coords = (columns, index) => { return [index % (columns + 1), Math.floor(index / (columns + 1))];};
  var get_pixel_coords = (columns, index, char_width, char_height) => {
    var coords = get_coords(columns, index);
    return [coords[0] * char_width, coords[1] * char_height];
  }
  var get_simplex_noise_at = (coords, frequency, amplitude, octaves=1, lacunarity=2, gain=0.5) => {
    var octave_amplitude = amplitude;
    var octave_frequency = frequency;
    var result = 0;
    for (var i = 0; i < octaves; i++) {
      result += octave_amplitude * simplex_noise.noise2D(octave_frequency * coords[0], octave_frequency * coords[1]);
      octave_amplitude *= gain;
      octave_frequency *= lacunarity;
    }
    return result;
  }
  var simplex_value_to_vector = (amplitude, simplex_value) => {
    return [amplitude * Math.cos(simplex_value * Math.PI),
      amplitude * Math.sin(simplex_value * Math.PI)];
  }
  var setCharAtIndex = (canvas,index,chr) => {
    var str = canvas.text();
    if(index > str.length-1) return str;
    var new_str = str.substr(0,index) + chr + str.substr(index+1);
    canvas.text(new_str);
  };
  var setHalfPixel = (canvas,x,y,on_off=true,rules=[' ', '.', '`', ':']) => {
    // set "pixel" defined at top or bottom half of char, in this coord system
    // there are twice as many y rows
    var canvas_index = get_canvas_index(columns, x, Math.floor(y/2));
    var old_char = getCharAtIndex(canvas, canvas_index);
    var old_char_index = rules.indexOf(old_char);
    if (old_char_index == -1) {
      old_char_index = 0; // treat as neight pixel set
    }
    var top_val = old_char_index > 1;
    var bottom_val = old_char_index == 1 || old_char_index == 3;
    var is_bottom_val = y % 2;
    if (is_bottom_val) {
      bottom_val = on_off;
    } else {
      top_val = on_off;
    }
    var new_char_index = (bottom_val ? 1 : 0) + (top_val ? 2 : 0);
    setCharAtIndex(canvas, canvas_index, rules[new_char_index]);
    return old_char;
  }
  var getOtherHalfCoord = (x, y) => [x,  ((y % 2) ? -1 : 1) + y];
  var getCharAtIndex = (canvas,index) => {
    return canvas.text().charAt(index);
  };
  var get_bresenham_line_points = (line_points, is_connected=false) => {
    var return_points = [];
    for (var i = 0; i < line_points.length; i++) {
      var x0 = line_points[i][0];
      var y0 = line_points[i][1];
      var x1, y1;
      if (i == line_points.length - 1) {
        if (is_connected && line_points.length > 2) {
          x1 = line_points[0][0];
          y1 = line_points[0][1];
        } else {
          break;
        }
      } else {
        x1 = line_points[i+1][0];
        y1 = line_points[i+1][1];
      }
      if (isNaN(x0) || isNaN(x1) || isNaN(y0) || isNaN(y1)) {
        throw "NaNs detected";
      }
      var dx = Math.abs(x1-x0);
      var sx = x0<x1 ? 1 : -1;
      var dy = -Math.abs(y1-y0);
      var sy = y0<y1 ? 1 : -1;
      var err = dx+dy;
      while (true) {
        return_points.push([x0, y0]);
        if (x0==x1 && y0==y1) break;
        var e2 = 2*err;
        if (e2 >= dy) {
          err += dy;
          x0 += sx;
        }
        if (e2 <= dx) {
          err += dx;
          y0 += sy;
        }
      }
    }
    return return_points;
  }
  var get_bresenham_circle_points = function (x0, y0, radius) {
    var return_points = [];
    if (isNaN(x0) || isNaN(y0) || isNaN(radius)) {
      throw "NaNs detected";
    }
    var x = radius;
    var y = 0;
    var radiusError = 1 - x;

    while (x >= y) {
      return_points.push([x + x0, y + y0]);
      return_points.push([y + x0, x + y0]);
      return_points.push([-x + x0, y + y0]);
      return_points.push([-y + x0, x + y0]);
      return_points.push([-x + x0, -y + y0]);
      return_points.push([-y + x0, -x + y0]);
      return_points.push([x + x0, -y + y0]);
      return_points.push([y + x0, -x + y0]);
      y++;

      if (radiusError < 0) {
          radiusError += 2 * y + 1;
      }
      else {
          x--;
          radiusError+= 2 * (y - x + 1);
      }
    }
    return return_points;
  };
  var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;
    for (i = 0; i < sURLVariables.length; i++) {
      sParameterName = sURLVariables[i].split('=');
      if (sParameterName[0] === sParam) {
        return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
      }
    }
  };
  var isInt = (a) => { return (typeof a==='number' && (a%1)===0); };

  /*----------- Data Init -----------*/


  var init_poob_details = () => {
    poob_detail = [];
    poob_detail.push([
      "#%&%%@,((##..*********.**.,(,******",
      "@@@@@@@.%(@@.*,/((((/*****,,..*****",
      "@@@@@@,#////((#(##%#(///***/*******",
      "@@@@#*(###%#%##(/####(((((((//*,***",
      "@@@(#((((/(((////////(###%####(//**",
      "%&/#((((/(////****//**//(######//**",
      "###%###(%%#(/********//((#&&%%#((//",
      "#####@@@@@&&&%%(/****///*//&&@(/***",
      "####&@@@@@@@@&&((//****//#%@@(/****",
      "%###@@@@@@@@@@@@%(((((((/////##&(((",
      "%%%%@@@@@@@@@@@&((/////////*///##%(",
      "&&&&&@@@@@@@&%#(((/(//(((////*/%/((",
      "&&&&@@@&&&%%##(((#(//////(//////#((",
      "@@&@@@&&@&%&%%#((#(#%#///(//////(((",
      "&&&&@@@@@@&&%%%#(####%##(/((////(##",
      "&&&&&&@@@@@@&%#%##########((((//(#(",
      "@&&&&&&&&&@@@&&%%%#####%%#####((###",
      "@&&&&&&&&&&&@@&&%%%%%##%&%%&%##(###",
      "@@&&&%&&&&&&&&&@&&&&%%%%&&&&&%#((##"
    ]);
    poob_detail.push([
      "###%%%%%%%%%##################(//(((//#/,**(/*,***",
      "####%%%%%%%%#%%%%#/((#%((#/###(/#(/*,(*****,/*...*",
      "%######%%%%%#(%(##///(((((/((///(#(/*/(/*//,,,*,,*",
      "#%%%%%%%%%#(/*/*/(//**/((//#(//((/(//(//(/(/*,//,*",
      "%%%%%%%%%%(/////*//(*,*///**////**/*//(((##/,.,//*",
      "%%%%%%%%#////((//////**////***//**//////((/(*,*,.*",
      "%%%%%%%#((((//(///*//****/////**//////(((((/,,,.,*",
      "%%%%%###((#(//****/*******/(///*/*/*/((/((/*/**(,*",
      "%%&&&%##(((((((/(/**/*****,/(//(##(///*((/((/*****",
      "%%&&%#####(((###(#/*(///*****(/%#(/#(((//((///****",
      "%%&&%%%%########(/((/*//*//***/*((#(//(((((((///**",
      "%%&&%###(###%&@(##((////*///**//*////***////**/***",
      "%&&%####%&@&(//////////////*/*////////////**(*****",
      "%%&%#%%%%%&&%#%((((((////**/*/**********/***///***",
      "%%&&%%&&&%#####((///**///***//****,*****/////*///*",
      "%&%&&&&&%%%%###((///((////(%%&&&&&&&*******/////(*",
      "&%%&&&&%%%######%%(/////(&&@&&%&%%&&&(**//*////((*",
      "%%%%&&&%%#%##(((((((((//&@@@@&&%&&@@@%***//**/((/*",
      "%%&&&&%%%###%##%###(#(//#@@@@@@@&&@@@(***/**/((//*",
      "%&&&&&%%%%#%%%########(//(#&@&@@&@&&(/***///((///*",
      "%%&&&&%%%%%##%###%%#%#((////#&&&&@#//*///(//(((//*",
      "%&&&&&%%%%%%%#######((///#((#(/%#(##(((###(((((***",
      "&&&&@@%%&&%%%&%##&&%%##(####(##%&&%%(///((#(#((#(*",
      "&&&&@@&%%%%%#(#%&&&&&&&&%%#%%%####(////((((%###((*",
      "&&&&%#%#%##&@@%&&&&&&%####((//(((/(((/##(##(#*****",
      "&&&&%##%#%%#%&%%%&&&%%%###(#/##(#(/#((##%#%((*****",
      "&&%%%%###%%%((#(#%&&%%%%%%%#%###%(##%#%%#%###(#***",
      "%&%#(%##%%%####%%%%%%%%%&&&&&%%%%%%%%%%#(#%%(((((*",
      "%#%###%%###%%%%%%###%#%#%#%%&&&&@@&@&&%%(&%%#%#((*",
      "&%(%%%#&&%##%#%######%##%%%##%%#%%%%###(#%%#%#%##*"
    ]);
    poob_detail.push([
      "####%%%%%%%%%%%%%%%%%%%%%%################%###################(((/((/*/#(/***((((*,*,,,///(#/,*(##/*",
      "#####%%%%%%%%%%%%%%%%%%##########(##(#((#%%%#(((##%###%(######(/((//**//*//##/**,,,/*/(((/,,*,,**/,*",
      "##########%%%%%%%%%%%%%%%####%%%###((((((#####((#(###(/###%%##(/((((/((/***//,,*/***,,/*,/**,...,,,*",
      "#########%##%%%%%%%%%%%##%##%%##%%%%#//(/(((#%#(((#(((/####(/(/((##(///*,**/**//*/////*,,,,,,,**/***",
      "####%#%#%%#%%%%%%%%%%%%%###%%#%#####((//*/(((((##(#((/((#((/((((/(/#((/***///((/*,*,//**,*,/////(/**",
      "####%#%%%%%%%%%%%%%%%%%%##(/(#######(///**/((#((((/((/((((//////(//(///////(((///////****,,.,,,**,,*",
      "##%%%%%%%%%%%%%%%%%%%##((///////(((((//*/**//(##(/((//(#((//(/((//////((////(///////*******,*((#(/,*",
      "#%%%%%%%%%%%%%%%%%%%%#(((/(//**///(((//******//((((///(#(//////(///(/////((((///(((((((((/***,*/,,**",
      "#%%%%%%%%%%%%%%%%%%###(///((////**////(//*,***//////**/*/****/*///////((/////((((((((##///,...,*/***",
      "%%%%%%%%%%%%%%%%%%%######((////////**//(//****///////**////**/************//((((((((((/***,,*//*,,,*",
      "%%#%%%%%%%%%%%&%%#(((//((((((////////*////**,**//**///***//*****************//((((((//***,,,**,....*",
      "%%%%%%%%%%%%%%%#((((///////(/(////////**///****/*/*/////*/***/////((###((((((/((((((((/((/,..,,,,***",
      "%%%%%%%%%%%&%%#(#(((((((/////(///////****//******////////*/***///////***///////(###(/((/**,,,,,,..**",
      "%%%%%%%%%%%%#%#((((((##((/////(/*////**/**//*//***/*/(((/////*/***////////////((((#((((((/,,****///*",
      "%%%%%%%%%%%#####(####((((/(//******/*********/****/////(///////******/**/////////****/////(//*,*****",
      "%%%%%%%%%&&%%%%(((((((((//////**////*/*/******/*****//(/((/////////////***//((((((((((/////,***,.,**",
      "%%%%%%%&&%%%%%#(##(((((((/(/(((/((//*/***/*/**//******/(((////(/(/(((((/*///**/(((((((///(/,*,,,,,**",
      "%&%&&&&&&&###((((((((((((((((((#(/*****//*/*/*********//(///(%&@@%((//////////((((//(((/***/(***,***",
      "%%%&&&&&&&%#######((((((((#(((((((#((***///////(********///(((%&@@##%%#((((((/(((//(((((((///((///**",
      "%%%%%&&&&%#####(#######(((##########((//(*//**/*/*********(//**/##&&((////##((((((///((((////*******",
      "%%%%&&&&####%%##(#######((##%%%###(((//*/*/****///*********////(((%%#(/////((((((((((((///**/*******",
      "%%%%%&&&%#%%%%%%###########(////////**//////*/*/*/////*****/*/*////((/////*////((///((((((////******",
      "%%%%%&&&%%########((#####%%&((#%##(////***/(/////////***/**/**///////******//////(///*/////*********",
      "%%%%&&&&########(###%%&@@@&&/%##((((((/(////*//*//////*//*////////////////*/*///////////*////***/***",
      "%%%%&&&&%##%%#######%%%&@@@@@&&%%(((///////////(/////////**/**/**///*///////////////////////*****//*",
      "%%%%&&&&%%%#((#####%%%&@@@@@%(((/(((((((/((/////////////*//******/**//**////**////////********////**",
      "%%%%%&&##%%%##%#%#%&&&&&%%####(((//(((((/(((//*//*/*///*////*****//****/******////////////////******",
      "%%%&&&&%%%%&&&&&&&&%%&&%%%##%####((((((////////////****//////*/*******************/*/******/***//***",
      "%%%&&&&&&&%%%&&&&&&%%%%%%####((((((///******/*//**//*****////*/*******,***********/**/////****////**",
      "%%%%&&&&&&%%&&@&&&%%%##%##(####(((((//////*******//***/***//*///((//*******,***/////////////*////***",
      "%%%%%&&&&&&&&&&&&%%%%%%#####((((((((###((//////***////(((((#%&&&&&&&&***,,**///*///*///*****/////***",
      "&%&&&&&&&&&&&&&&%%%%%%%#(#######((////////(//((////((#%&&&&&&&&&&&&&&&&&*,***///****/////(((((/((***",
      "%&%%%&&&&&&&&&&%%%%%%%##############(/*/**//////((#%&&&&&@&&&&%&%%%%%&&&&&&*****///////////////((//*",
      "%%%%%%%&&&&&&&&%%%%%%#######%######%%%%%(///*////#&@&&&@@&%%%%#%%&%&&&@&&&&%*****////**///////(((((*",
      "%%%%%&%&&&&&&%&%%%%%%################((####(////(&@@@@@@&%&&@&%&&&&%&@@@@&&%********/*****///((/(//*",
      "%%%%%&%&&&&&&&%%%%##%%#####(((((((((#((((((/////(&@@@@@@&&@@@@&&&&&&@@@@@@******////////((//(((//***",
      "%%%&&&&&&&&&&%&%%%########################(((///(%@@@@@@&@@@@@@@&&&&&@@@&&%(******///////(((((((//**",
      "%%%&&&&%&&&&&&%%%%###########%#%##########((////((#&@@@@@@@@@@@@&&@&&&&&&@%/*******///**//(#((/////*",
      "%&&&&&&&&&&&&%%%%%#%%%##%%%%%#############(((((///((%%&&&%&&&@@@&&@@&&&&&%(/*******//*////((/(/(//**",
      "%&&%%&&&&&&&%%%%###%%%%%#%%#######%###%%%####((((((/((#%@@@@@@@&&&@@&&&((/***//*///////((((//////***",
      "%%&&&&&&&&&&&%%##%%%%%&%###%######%%%%%%%#%%#(((//((//((%&@@@@&&&&@&&((////*/////////(/((((////(/***",
      "%%&&&&&&&&%%%%#%#%%%%%#%#%%%######%%%%%%###(((((((((/////(%#%%#%%%&@#(#(((//////(((((/((((((//////(*",
      "%%%&&&&&&&&%&&%%%%&%%%%%%%%#######%%########((///////(#//#/(((((####(##/#((((/((###(##((((//(((((***",
      "%%&&&&&&&@@&%&%%%&&%%%%&%%#%%####%%#########(((((((((#((((((((((###(%%(#(((((((####(#(((/(((##(*****",
      "&&&&&&&&&&&@@&%%&%&%%%%%%&%%&%%###%&%%%%%%%###(((((#(#((#(((#(#####%&%&%%%(((//(((((#(#((#(((((###(*",
      "&&&&&&&&&&@@&%%%%&%&%%%%%%%%%%%%#%&&&%&&%%######%%##%#####&&%&&&%&&%%#(((//////((((#####(((((((((***",
      "&&&&&&&&&@@@&&&%%%%%%%%%%%%###%%%&&&&&&&&&%%%#&&&%%%%%%%%%&&%&&%&&%%%((*//*///((((((/(###(((##(#(((*",
      "&&&&&&&&&@@@@%%#%%%%%%%####%%%&%&&&&&@@%@&%&&&&&%%#########((/#/((((*/////((/(((((((%%%#(#(##((#(***",
      "&&&&&&&&&&&%%%%%#%##%#%####%&&&&&%&&&&&@&&&&&&&&%%%###(#(((((///(/(((((/(((//((/(((#((%####((((#(***",
      "&&&&&&&&@%%&%###%%#%%%%###&&&&@@&%%%%&&&&&&%%&%#######(((((/*((//((/((/(##(/(((#######%%#####((##***",
      "&&&&&&&@&@&##%%%###%%##%%&&&&%%%%%%%&&&&&&&%%#%##%####((#/(##(((((((((###((((###%%##%#####((#*******",
      "&&&&&&%#%###%%%%#%#%%%#%&&%####%%%%%&&&&&&&%%#%###%%%%####(((#(#((###(((%%%#((%%%%%%%#%%#####((((***",
      "&&&&%%%%#&%#%%#%%%&%###########%&&&&&%%&%##%#%%%%%%%##%#(###%#(#%##(((%##%(#%&&%%%%%%%###((((##*****",
      "%&&&%##%&%%#(#%###%#%#####(#(#(##%%%%%&%%%%%%%%%%%%%%%%%%%#(%%%####(##((#####%##%#######(((#####/((*",
      "&%&%&%#(#%####################%%%&&&%%%%%%%%%&&&&&&&&%%&%%%&%#%%%##%%%%%%%%%%#%%##%%##(((/((((#((***",
      "%&&%%#%#(#%%#%%####&%%#####%%%%%%%%%##%%##%%&%%&&&&&&&&%%%&&&&%%%%%%%%&%%%%%#%#(#%&%%%%#((((((((/***",
      "&%#%%&(##(%%#%&%#%#%%%##%%#%#%%%%%%%##%%%%#%###%%#%%%%&%%&&&&&&&&%&&&&%%%%%%%#%(#&&&%%%###((((/((***",
      "%%%#%%%#(%#%%##%(##(##%%%%%%%%%%%%#######%%%%%%##%%#%%%%%%&%&&%%&&&&@@@&&&%%#%%%(#%&%&%%%#%%#(#((((*",
      "#&&%((#(%#%#%&&%%###%%##%%%%#############%####%#%%%#%#%%###%%%%%&%%&%%%%%###%#(##&%%%%%#%%#%#(((#***",
      "%%%#(((#%%%#&%&&#%%#%%%%%%%%#((#####%%##%%#######%%####%%%####%%%%%#######(/(#%%%##(((##(######*****"
    ]);
    poob_detail_dims = [];
    for (var i = 0; i < poob_detail.length; i++) {
      poob_detail_dims.push([poob_detail[i][0].length, poob_detail[i].length]);
    }
  }

  var init_lorem_ipsum = () => {
    lorem_ipsum = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed"
      + "do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim"
      + " ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut al"
      + "iquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit "
      + "in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Except"
      + "eur sint occaecat cupidatat non proident, sunt in culpa qui officia de"
      + "serunt mollit anim id est laborum. Curabitur pretium tincidunt lacus. "
      + "Nulla gravida orci a odio. Nullam varius, turpis et commodo pharetra, "
      + "est eros bibendum elit, nec luctus magna felis sollicitudin mauris. In"
      + "teger in mauris eu nibh euismod gravida. Duis ac tellus et risus vulpu"
      + "tate vehicula. Donec lobortis risus a elit. Etiam tempor. Ut ullamcorp"
      + "er, ligula eu tempor congue, eros est euismod turpis, id tincidunt sap"
      + "ien risus a quam. Maecenas fermentum consequat mi. Donec fermentum. Pe"
      + "llentesque malesuada nulla a mi. Duis sapien sem, aliquet nec, commodo"
      + " eget, consequat quis, neque. Aliquam faucibus, elit ut dictum aliquet"
      + ", felis nisl adipiscing sapien, sed malesuada diam lacus eget erat. Cr"
      + "as mollis scelerisque nunc. Nullam arcu. Aliquam consequat. Curabitur "
      + "augue lorem, dapibus quis, laoreet et, pretium ac, nisi. Aenean magna "
      + "nisl, mollis quis, molestie eu, feugiat in, orci. In hac habitasse pla"
      + "tea dictumst.";
  }

  var init_browser_info = () => {
    var info = {};
    info["timeOpened"] = (new Date()).toString();
    info["timeZone"] = ((new Date()).getTimezoneOffset()/60).toString();
    info["javaEnabled"] = navigator.javaEnabled();
    info["pageon"] = window.location.pathname
    info["referrer"] = document.referrer;
    info["previousSites"] = history.length;
    info["browserName"] = navigator.appName;
    info["browserEngine"] = navigator.product;
    info["browserVersion1a"] = navigator.appVersion;
    info["browserVersion1b"] = navigator.userAgent;
    info["browserLanguage"] = navigator.language;
    info["browserOnline"] = navigator.onLine;
    info["browserPlatform"] = navigator.platform;
    info["dataCookiesEnabled"] = navigator.cookieEnabled;
    info["dataCookies2"] = decodeURIComponent(document.cookie.split(";"));
    info["dataCookies1"] = document.cookie;
    info["dataStorage"] = localStorage;
    info["sizeScreenW"] = screen.width;
    info["sizeScreenH"] = screen.height;
    info["sizeDocW"] = document.width;
    info["sizeInW"] = innerWidth;
    info["sizeDocH"] = document.height;
    info["sizeInH"] = innerHeight;
    info["sizeAvailH"] = screen.availHeight;
    info["sizeAvailW"] = screen.availWidth;
    info["scrColorDepth"] = screen.colorDepth;
    info["scrPixelDepth"] = screen.pixelDepth;
    browser_info = JSON.stringify(info);
  }

  /*----------- Animations -----------*/
  var this_weight = 0;
  var animations = new ObjectSampler()
    // do nothing
    .put((this_animation) => {return;}, 0)
    // . to o random
    .put((this_animation) => {
      init_flat_index_list(rows, columns);
      for (var n = 0; n < animation_speed_multiplier; n++) {
        var index = Math.floor(Math.random() * flat_index_list.length);
        setCharAtIndex(canvas, flat_index_list[index], "o");
        flat_index_list.splice(index, 1);
        if (flat_index_list.length <= 0) {
          return;
        }
      }
      setTimeout(this_animation.bind(null, this_animation), 0);
    }, 1)
    // random text wipe
    .put((this_animation) => {
      init_flat_index_list(rows, columns);
      if (frame_count == 0) {
        var char_level_generator = (num_chars, generator) => {
            var text = "";
            for (var i = 0; i < num_chars; i++) {
              text += generator();
            }
            return text;
        };
        var radix_digit_generator =
          (num_chars, radix) => char_level_generator(num_chars, () =>
            Math.floor(Math.random() * radix).toString(radix));
        //duplicates text and removes spaces at start of lines for aesthetics
        var text_formatter = (input_text, num_chars) => {
          var text = input_text;
          while (text.length < num_chars + columns) {
            text += " " + input_text;
          }
          for (var i = 0; i < rows; i++) {
            var index = i * columns;
            while (text[index] == " ") {
              text = text.substr(0, index) + text.substr(index + 1);
            }
          }
          text = text.substring(0, num_chars);
          return text;
        }
        var textgen_funcs = new ObjectSampler()
          .put((num_chars) => $('html').html().replace(/\s/g, "").substring(0, num_chars))
          .put((num_chars) => radix_digit_generator(num_chars, 16), 1) // hex
          .put((num_chars) => radix_digit_generator(num_chars, 2), 1) // binary
          .put((num_chars) => radix_digit_generator(num_chars, 10), 0.5) // base 10
          .put((num_chars) => radix_digit_generator(num_chars, 8), 0.5) // octal
          .put((num_chars) => radix_digit_generator(num_chars, 36), 0.5) // hexatridecimal
          .put((num_chars) => char_level_generator(num_chars, () => Math.floor(
            Math.random() * 24 + 10).toString(36)), 1) // letters
          .put((num_chars) => { // lorem ipsum
            init_lorem_ipsum();
            return text_formatter(lorem_ipsum, num_chars);
          }, 1.25)
          .put((num_chars) => {
            init_browser_info();
            return text_formatter(browser_info, num_chars);
          }, 1.25);

        try {  // pi (some browsers don't have bigint support)
          textgen_funcs.put((num_chars) => {
            let i = BigInt(1);
            let x = BigInt(3) * (BigInt(10) ** BigInt(num_chars+20)+BigInt(20));
            let pi = x;
            while (x > 0) {
                    x = x * i / ((i + BigInt(1)) * BigInt(4));
                    pi += x / (i + BigInt(2));
                    i += BigInt(2);
            }
            var text = (pi / (BigInt(10) ** BigInt(20))).toString();
            text = "3." + text.substring(1);
            text = text.substring(0, num_chars);
            return text;
          }, 1);
        } catch(e) {}

        text_to_print = textgen_funcs.sample()(columns*rows);
      }
      setCharAtIndex(canvas, flat_index_list[0], text_to_print[0]);
      flat_index_list.shift();
      text_to_print = text_to_print.slice(1);
      if (flat_index_list.length <= 0) {
        return;
      }
      setTimeout(this_animation.bind(null, this_animation), 0);
      frame_count++;
    }, 5)
    // 10 print styles up or down
    .put((this_animation) => {
      var isupdown = constant_random_boolean;
      if (frame_count == 0) {
        var character_generators = new ObjectSampler()
          .put(() => ['/', '\\'][Math.floor(Math.random()*2)], 2)
          .put(() => ['/', '\\'][Math.floor(Math.random()+constant_random_values[0])], 2)
          .put(() => ['\u2502', '\u2500'][Math.floor(Math.random()*2)], 2)
          .put(() => ['\u2502', '\u2500'][Math.floor(Math.random()+constant_random_values[0])], 2)
          .put(() => {flip ^= true; return ['/', '\\'][flip];}, 1.5)
          .put(() => ['/', '\\', ' ', ' '][Math.floor(Math.random()*4)], 0.75)
          .put(() => ['/', ' ', ' '][Math.floor(Math.random()*3)], 1)
          .put(() => ['\\', ' ', ' '][Math.floor(Math.random()*3)], 1)
          .put(() => ['\u2588', ' '][Math.floor(Math.random()*2)], 0.25)
          .put(() => '\\', 0.5)
          .put(() => '/', 0.5);
        character_generator = character_generators.sample();
      }
      var y = frame_count;
      for (var x = 0; x < columns; x++) {
        var index = get_canvas_index(columns, x, isupdown ? rows - y : y);
        var random_slash = character_generator();
        setCharAtIndex(canvas, index, random_slash);
      }
      if (frame_count >= rows) return;
      frame_count++;
      setTimeout(this_animation.bind(null, this_animation), 50);
    }, 10)
    // growing circle / entombing circle
    .put((this_animation) => {
      init_flat_index_list(rows, columns);
      var isminmax = constant_random_boolean;
      var center_x = columns / 2;
      var center_y = rows / 2;
      for (var n = 0; n < animation_speed_multiplier; n++) {
        var minmax_dist = 9999999 * (isminmax ? 1 : -1);
        var minmax_dist_index = -1;
        for (var i = 0; i < flat_index_list.length; i++) {
          var coords = get_coords(columns, flat_index_list[i]);
          var dist = Math.sqrt(Math.pow((center_x - coords[0]) * char_width, 2) + Math.pow((center_y - coords[1]) * char_height, 2))
          if (isminmax && dist < minmax_dist || !isminmax && dist > minmax_dist) {
            minmax_dist = dist;
            minmax_dist_index = i;
          }
        }
        setCharAtIndex(canvas, flat_index_list[minmax_dist_index], "o");
        flat_index_list.splice(minmax_dist_index, 1);
        if (flat_index_list.length <= 0) {
          return;
        }
      }
      setTimeout(this_animation.bind(null, this_animation), 0);
    }, 1)
    // entombing triangles
    .put((this_animation) => {
      init_flat_index_list(rows, columns);
      var theta = constant_random_values[0] * Math.PI * 2;
      var a = Math.cos(theta);
      var b = Math.sin(theta);
      var c = constant_random_values[0] * 100000;
      for (var n = 0; n < animation_speed_multiplier; n++) {
        var min_dist = 9999999;
        var max_dist = -9999999;
        var min_dist_index = -1;
        var max_dist_index = -1;
        for (var i = 0; i < flat_index_list.length; i++) {
          var coords = get_coords(columns, flat_index_list[i]);
          var pixel_coords = [coords[0] * char_width, coords[1] * char_height];
          var dist = Math.abs(a * pixel_coords[0] + b * pixel_coords[1] + c) / Math.sqrt(Math.pow(a, 2) + Math.pow(b, 2));
          if (dist < min_dist) {
            min_dist = dist;
            min_dist_index = i;
          }
          if (dist > max_dist) {
            max_dist = dist;
            max_dist_index = i;
          }
        }
        setCharAtIndex(canvas, flat_index_list[min_dist_index], "o");
        setCharAtIndex(canvas, flat_index_list[max_dist_index], "o");
        flat_index_list.splice(max_dist_index, 1);
        if (max_dist_index != min_dist_index) {
          if (max_dist_index < min_dist_index) {
            flat_index_list.splice(min_dist_index - 1, 1);
          } else {
            flat_index_list.splice(min_dist_index, 1);
          }
        }
        if (flat_index_list.length <= 0) {
          return;
        }
      }
      setTimeout(this_animation.bind(null, this_animation), 0);
    }, 1)
    // growing heart / entombing heart
    .put((this_animation) => {
      init_flat_index_list(rows, columns);
      var isminmax = constant_random_boolean;
      var center_x = columns / 2;
      var center_y = rows / 4 - (frame_count * 0.0001);
      var heart_multiplier = isminmax ? 2 : 45 * (animation_speed_multiplier + 2);
      var pixels_changed = 0;
      var tries = 0;
      while (pixels_changed < animation_speed_multiplier * 10) {
        frame_count++;
        var minmax_dist = 9999999 * (isminmax ? 1 : -1);
        var minmax_dist_index = -1;
        for (var i = 0; i < flat_index_list.length; i++) {
          var coords = get_coords(columns, flat_index_list[i]);
          var dist = Math.sqrt(Math.pow((coords[0] - center_x) * char_width, 2) + Math.pow((coords[1] - center_y) * char_height, 2))
          var theta = Math.atan2((center_y - coords[1]) * char_height, (center_x - coords[0]) * char_width);
          var heart_radius =
            heart_multiplier * (2 - 2 * Math.sin(theta) + Math.sin(theta)
            * (Math.sqrt(Math.abs(Math.cos(theta))) / (Math.sin(theta) + 1.4)));
          if (isminmax && dist < minmax_dist && dist < heart_radius || !isminmax && dist > minmax_dist && dist > heart_radius) {
            minmax_dist = dist;
            minmax_dist_index = i;
          }
        }
        if (minmax_dist_index == -1) {
          tries++;
          if (tries > 1000) {
            while (true) {
              setCharAtIndex(canvas, flat_index_list[0], "o");
              flat_index_list.shift();
              if (flat_index_list.length <= 0) {
                return;
              }
            }
          }
          heart_multiplier += 3 * (isminmax ? 1 : -1);
          continue;
        }
        setCharAtIndex(canvas, flat_index_list[minmax_dist_index], "o");
        pixels_changed++;
        flat_index_list.splice(minmax_dist_index, 1);
        if (flat_index_list.length <= 0) {
          return;
        }
      }
      setTimeout(this_animation.bind(null, this_animation), 0);
    }, 0.25)
    // simplex growth
    .put((this_animation) => {
      var simplex_frequency = animation_speed_multiplier * -0.0001635 + 0.00237;
      var simplex_amplitude = 1;
      var octaves = Math.floor(constant_random_values[0] * Math.min(animation_speed_multiplier - 1, 3)) + 1;
      init_simplex_noise();
      init_flat_index_list(rows, columns, (index1, index2) => {
        var coords1 = get_pixel_coords(columns, index1, char_width, char_height);
        var coords2 = get_pixel_coords(columns, index2, char_width, char_height);
        return get_simplex_noise_at(coords1, simplex_frequency, simplex_amplitude, octaves)
        - get_simplex_noise_at(coords2, simplex_frequency, simplex_amplitude, octaves);
      });
      for (var n = 0; n < animation_speed_multiplier; n++) {
        setCharAtIndex(canvas, flat_index_list[0], "o");
        flat_index_list.shift();
        if (flat_index_list.length <= 0) {
          return;
        }
      }
      setTimeout(this_animation.bind(null, this_animation), 0);
    }, 1.25)
    // mapgen
    .put((this_animation) => {
      var isisland = constant_random_boolean;
      var frequency = animation_speed_multiplier * -0.0001635 + 0.00237;
      var amplitude = 1;
      var octaves = Math.floor(Math.min(animation_speed_multiplier - 1, 3)) + 1;
      var lacunarity = 2;
      var gain = 0.5;
      var pixels_changed = 0;
      init_falloff_map(rows, columns, char_width, char_height);
      init_simplex_noise();
      init_mapgen_tiles();
      var value_at = (coords) => {
        var value = get_simplex_noise_at(coords, frequency, amplitude, octaves, lacunarity, gain);
        if (isisland) {
          value -= falloff_map(coords);
        }
        return value;
      }
      init_flat_index_list(rows, columns, (index1, index2) => {
        var coords1 = get_pixel_coords(columns, index1, char_width, char_height);
        var coords2 = get_pixel_coords(columns, index2, char_width, char_height);
        return value_at(coords1)
        - value_at(coords2);
      });
      if (!mapgen_probabilities) {
        mapgen_probabilities = [];
        var max_amplitude = amplitude * (Math.pow(gain, octaves) - 1) / (gain - 1);
        mapgen_probabilities.push(max_amplitude);
        mapgen_probabilities.push(-0.15);
        for (var i = 0; i < flat_mapgen_tiles.length - 2; i++) {
          mapgen_probabilities.push((i + 1) * amplitude / (flat_mapgen_tiles.length - 1));
        }
        mapgen_probabilities.sort();
        for (var i = 0; i < flat_mapgen_tiles.length; i++) {
          index_lists.push([]);
        }
        var current_noise;
        var current_tile_index = 0;
        for (var i = 0; i < flat_index_list.length; i++) {
          current_coords = get_pixel_coords(columns, flat_index_list[i], char_width, char_height);
          current_noise = value_at(current_coords);
          for (var j = 0; j <= current_tile_index; j++) {
            index_lists[j].push(flat_index_list[i]);
          }
          if (current_noise > mapgen_probabilities[current_tile_index]) {
            current_tile_index = Math.min(current_tile_index + 1, flat_mapgen_tiles.length - 1);
          }
        }
      }
      var any_pixels = false;
      for (var i = 0; i < index_lists.length; i++) {
        while(index_lists[i].length > 0 && pixels_changed < animation_speed_multiplier * 4) {
          setCharAtIndex(canvas, index_lists[i][0], flat_mapgen_tiles[i]);
          index_lists[i].shift();
          pixels_changed++;
          any_pixels = true;
        }
      }
      if (!any_pixels) return;
      setTimeout(this_animation.bind(null, this_animation), 0);
    }, 1.5)
    // dvd ball
    .put((this_animation) => {
      var width = columns * char_width;
      var height = rows * char_height;
      var ball_radius_pixels = Math.min((Math.min(width, height) / 3), constant_random_values[0] * Math.max(25, max_dim) + 75);
      if (frame_count == 0) {
        bounces = 0;
        var ball_speed = Math.min(Math.random(), Math.random(), Math.random()) * Math.min(Math.min(width, height) - 2 * ball_radius_pixels, 50);
        var theta = Math.random() * 2 * Math.PI;
        velocity_pixels = [ball_speed * Math.cos(theta), ball_speed * Math.sin(theta)];
        position_pixels = [Math.random() * (width - 2 * ball_radius_pixels) + ball_radius_pixels,
          Math.random() * (height - 2 * ball_radius_pixels) + ball_radius_pixels];
      }
      var ball_coords = [];
      var min_x = Math.max(0, Math.floor(-1 + (position_pixels[0] - ball_radius_pixels) / char_width));
      var max_x = Math.min(columns, Math.floor(1 + (position_pixels[0] + ball_radius_pixels) / char_width));
      var min_y = Math.max(0, Math.floor(-1 + (position_pixels[1] - ball_radius_pixels) / char_height));
      var max_y = Math.min(rows, Math.floor(1 + (position_pixels[1] + ball_radius_pixels) / char_height));
      for (var i = min_x; i < max_x; i++) {
        for (var j = min_y; j < max_y; j++) {
          var x_pixels = (i + 0.5) * char_width;
          var y_pixels = (j + 0.5) * char_height;
          if (Math.sqrt(Math.pow(x_pixels - position_pixels[0], 2) + Math.pow(y_pixels - position_pixels[1], 2)) <= ball_radius_pixels) {
            ball_coords.push([i, j]);
          }
        }
      }
      var text = (".".repeat(columns) + "\n").repeat(rows);
      for (var i = 0; i < ball_coords.length; i++) {
        var index = get_canvas_index(columns, ball_coords[i][0], ball_coords[i][1]);
        text = text.substr(0, index) + "o" + text.substr(index + 1);
      }
      canvas.text(text);

      position_pixels = [position_pixels[0] + velocity_pixels[0],
        position_pixels[1] + velocity_pixels[1]];
      if (bounces < 100) {
        if (position_pixels[0] < ball_radius_pixels) {
          velocity_pixels[0] *= -1;
          position_pixels[0] += 2 * (ball_radius_pixels - position_pixels[0]);
          bounces++;
        } else if (position_pixels[0] > width - ball_radius_pixels) {
          velocity_pixels[0] *= -1;
          position_pixels[0] -= 2 * (position_pixels[0] + ball_radius_pixels - width);
          bounces++;
        }
        if (position_pixels[1] < ball_radius_pixels) {
          velocity_pixels[1] *= -1;
          position_pixels[1] += 2 * (ball_radius_pixels - position_pixels[1]);
          bounces++;
        } else if (position_pixels[1] > height - ball_radius_pixels) {
          velocity_pixels[1] *= -1;
          position_pixels[0] -= 2 * (position_pixels[1] + ball_radius_pixels - height);
          bounces++;
        }
      } else {
        if (position_pixels[0] < -ball_radius_pixels
          || position_pixels[1] < -ball_radius_pixels
          || position_pixels[0] > width + ball_radius_pixels
          || position_pixels[1] > height + ball_radius_pixels) {
          return;
        }
      }


      frame_count++;
      setTimeout(this_animation.bind(null, this_animation), 0);
    }, 1)
    //poob
    .put((this_animation) => {
      var isminmax = constant_random_boolean;
      var center_x = columns / 2;
      var center_y = rows / 2;
      init_poob_details();
      init_flat_index_list(rows, columns, (index1, index2) => {
        var coords1 = get_coords(columns, index1);
        var coords2 = get_coords(columns, index2);
        var diff =  Math.sqrt(Math.pow((center_x - coords1[0]) * char_width, 2) + Math.pow((center_y - coords1[1]) * char_height, 2))
        - Math.sqrt(Math.pow((center_x - coords2[0]) * char_width, 2) + Math.pow((center_y - coords2[1]) * char_height, 2));
        return diff * (isminmax ? 1 : -1)
      });
      var poob_detail_index = -1;
      var poob_detail_score = 99999999999;
      for (var i = 0; i < poob_detail_dims.length; i++) {
        var score;
        var ascii_dims = poob_detail_dims[i];
        var canvas_dims = [columns, rows];
        if ((ascii_dims[0] <= canvas_dims[0] && ascii_dims[1] <= canvas_dims[1])
          || (ascii_dims[0] >= canvas_dims[0] && ascii_dims[1] >= canvas_dims[1])) {
          score = Math.abs(ascii_dims[0] * ascii_dims[1] - canvas_dims[0] * canvas_dims[1]);
        } else if (ascii_dims[0] > canvas_dims[0] && ascii_dims[1] < canvas_dims[1]) {
          score = (ascii_dims[0] - canvas_dims[0]) * ascii_dims[1]
            + (canvas_dims[1] - ascii_dims[1]) * canvas_dims[0];
        } else if (ascii_dims[0] < canvas_dims[0] && ascii_dims[1] > canvas_dims[1]) {
          score = (canvas_dims[0] - ascii_dims[0]) * canvas_dims[1]
            + (ascii_dims[1] - canvas_dims[1]) * ascii_dims[0];
        }
        if (score < poob_detail_score) {
          poob_detail_score = score;
          poob_detail_index = i;
        }
      }
      for (var n = 0; n < animation_speed_multiplier; n++) {
        var index = flat_index_list[0];
        setCharAtIndex(canvas, index, get_ascii_char_from_canvas_index(poob_detail[poob_detail_index], columns, rows, index));
        flat_index_list.shift();
        if (flat_index_list.length <= 0) {
          return;
        }
      }
      setTimeout(this_animation.bind(null, this_animation), 0);
    }, 0.75)
    // bresenham bounce
    .put((this_animation) => {
      var width = columns * char_width;
      var height = rows * char_height;
      var is_growth = constant_random_boolean;
      var is_connected = constant_random_values[2] < 0.5;
      var growth_per_frame = Math.floor(constant_random_values[0] * animation_speed_multiplier * 5 + frame_count / 100);
      if (frame_count == 0) {
        var number_points = Math.floor(Math.min(Math.random(), Math.random(), Math.random()) * 5) + 2;
        bounces = 0;
        line_points = [];
        position_pixels = [];
        velocity_pixels = [];
        var distance_from_edge = (coord) => Math.min(coord[0], coord[1], columns - coord[0] - 1, rows * 2 - coord[1] - 1) + 0.0000001 * coord[0] + 0.0001 * coord[1];
        empty_half_pixels = new SortedSet((coord1, coord2) => distance_from_edge(coord1) - distance_from_edge(coord2));
        var thetas = [];
        var point_speeds = [];
        for (var i = 0; i < number_points; i++) {
          line_points.push([Math.floor(Math.random() * columns),
          Math.floor(Math.random() * rows) * 2]);
          point_speeds.push(Math.random() * 15 + 5);
          thetas.push(Math.random() * 2 * Math.PI);
          velocity_pixels.push([point_speeds[i] * Math.cos(thetas[i]), point_speeds[i] * Math.sin(thetas[i])]);
          position_pixels.push([line_points[i][0] * char_width, line_points[i][1] * half_char_height]);
        }
        for (var x = 0; x < columns; x++) {
          for (var y = 0; y < rows; y++) {
            empty_half_pixels.add([x, y * 2]);
          }
        }
      }

      var bresenham_points = get_bresenham_line_points(line_points, is_connected);
      if(last_points) {
        for (var i = 0; i < last_points.length; i++) {
          var coords = last_points[i];
          var other_half_coords = getOtherHalfCoord(coords[0], coords[1]);
          setHalfPixel(canvas, coords[0], coords[1], false);
          setHalfPixel(canvas, other_half_coords[0], other_half_coords[1], false);
          empty_half_pixels.add(coords);
          empty_half_pixels.add(other_half_coords);
        }
      }
      if (is_growth) {
        var rules = [" ", "."];
        var added_pixels = 0;
        while (added_pixels < growth_per_frame) {
          var randomness = Math.min(Math.random(), Math.random(), Math.random(), Math.random());
          var search_window_size = (constant_random_values[1] * 1000 + 200) * animation_speed_multiplier;
          var index = Math.floor(randomness * Math.min(search_window_size, empty_half_pixels.size));
          var coords = empty_half_pixels.pop_index(index);
          setHalfPixel(canvas, coords[0], coords[1], true);
          added_pixels++;
          if (empty_half_pixels.size <= 0) {
            return;
          }
        }
      } else {
        if (empty_half_pixels.size >= rows * 2 * columns) {
          return;
        }
      }
      for (var i = 0; i < bresenham_points.length; i++) {
        var coords = bresenham_points[i];
        setHalfPixel(canvas, coords[0], coords[1], true);
      }
      last_points = bresenham_points;
      for (var i = 0; i < position_pixels.length; i++) {
        position_pixels[i][0] = position_pixels[i][0] + velocity_pixels[i][0];
        position_pixels[i][1] = position_pixels[i][1] + velocity_pixels[i][1];
      }
      for (var i = 0; i < position_pixels.length; i++) {
        if (position_pixels[i][0] < 0) {
          velocity_pixels[i][0] *= -1;
          position_pixels[i][0] -= 2 * position_pixels[i][0];
          bounces++;
        } else if (position_pixels[i][0] >= width) {
          velocity_pixels[i][0] *= -1;
          position_pixels[i][0] -= 2 * (position_pixels[i][0] - width);
          bounces++;
        }
        if (position_pixels[i][1] < 0) {
          velocity_pixels[i][1] *= -1;
          position_pixels[i][1] -= 2 * (position_pixels[i][1]);
          bounces++;
        } else if (position_pixels[i][1] >= height) {
          velocity_pixels[i][1] *= -1;
          position_pixels[i][1] -= 2 * (position_pixels[i][1] - height);
          bounces++;
        }
      }
      for (var i = 0; i < line_points.length; i++) {
        line_points[i][0] = Math.floor(position_pixels[i][0] / char_width);
        line_points[i][1] = Math.floor(position_pixels[i][1] / half_char_height);
      }
      frame_count++;
      setTimeout(this_animation.bind(null, this_animation), 25);
    }, 1)
    // flow field particles
    .put((this_animation) => {
      var width = columns * char_width;
      var height = rows * char_height;
      if (frame_count == 0) {
        remaining_particles = 10000;
        particles = [];
        random_edge_point_sampler = new ObjectSampler()
          .put(() => [Math.random() * width, 0], width)
          .put(() => [Math.random() * width, height], width)
          .put(() => [0, Math.random() * height], height)
          .put(() => [width, Math.random() * height], height);

      }
      var simplex_frequency = animation_speed_multiplier * -0.0001635 + 0.00237;
      var simplex_amplitude = 1;
      var octaves = Math.floor(constant_random_values[0] * Math.min(animation_speed_multiplier - 1, 3)) + 1;
      var particle_lifespan = 10000;
      var new_particles_per_frame = 1;
      var acceleration_multiplier = 2;
      var timestep = 0.05;
      var max_new_particle_tries = 100;
      init_simplex_noise();
      var new_particle_count = 0;
      var new_particle_tries = 0;
      while (remaining_particles > 0 && new_particle_count < new_particles_per_frame) {
        var particle = new Particle(random_edge_point_sampler.sample()());
        var simplex_value = get_simplex_noise_at(particle.position, simplex_frequency, simplex_amplitude, octaves)
        var acceleration = simplex_value_to_vector(acceleration_multiplier, simplex_value);
        particle.step(acceleration, timestep);
        if (particle.inbounds(width, height)) {
          particles.push(particle);
          new_particle_count++;
        }
        new_particle_tries++;
        if (new_particle_tries > max_new_particle_tries) {
          return;
        }
      }
      remaining_particles -= new_particle_count;

      for (var i = 0; i < particles.length; i++) {
        var particle = particles[i];
        var simplex_value = get_simplex_noise_at(particle.position, simplex_frequency, simplex_amplitude, octaves)
        var acceleration = simplex_value_to_vector(acceleration_multiplier, simplex_value);
        particle.step(acceleration, timestep);
      }

      particles = particles.filter(particle => particle.inbounds(width, height));
      particles = particles.filter(particle => particle.framecount_under(particle_lifespan));

      var text = (".".repeat(columns) + "\n").repeat(rows);
      for (var i = 0; i < particles.length; i++) {
        var particle = particles[i];
        var coordinates = [Math.floor(particle.position[0] / char_width),
          Math.floor(particle.position[1] / char_height)];
        var index = get_canvas_index(columns, coordinates[0], coordinates[1]);
        text = text.substr(0, index) + "o" + text.substr(index + 1);
      }
      canvas.text(text);
      frame_count++;
      if (particles.length == 0) return;
      setTimeout(this_animation.bind(null, this_animation), 0);
    }, 2)
    // analog clock
    .put((this_animation) => {
      var width = columns * char_width;
      var height = rows * char_height;
      var center_point = [Math.floor(columns / 2), rows];
      var clock_radius = Math.floor(Math.min(columns, rows * 2)/3);
      var second_hand_radius = clock_radius * 0.75;
      var minute_hand_radius = clock_radius * 0.85;
      var hour_hand_radius = clock_radius * 0.6;
      var current_time = new Date();
      var normalized_milliseconds = current_time.getMilliseconds() / 1000;
      var normalized_seconds = (current_time.getSeconds() + normalized_milliseconds) / 60;
      var normalized_quantized_seconds = current_time.getSeconds() / 60;
      var normalized_minutes = (current_time.getMinutes() + normalized_seconds) / 60;
      var normalized_hours = (current_time.getHours() % 12 + normalized_minutes) / 12;
      var seconds_theta = 2 * Math.PI * (normalized_quantized_seconds - 0.25);
      var minutes_theta = 2 * Math.PI * (normalized_minutes - 0.25);
      var hours_theta = 2 * Math.PI * (normalized_hours - 0.25);
      var second_hand_end_point = [
        Math.round(second_hand_radius * Math.cos(seconds_theta) + center_point[0]),
        Math.round(second_hand_radius * Math.sin(seconds_theta) + center_point[1])];
      var minute_hand_end_point = [
        Math.round(minute_hand_radius * Math.cos(minutes_theta) + center_point[0]),
        Math.round(minute_hand_radius * Math.sin(minutes_theta) + center_point[1])];
      var hour_hand_end_point = [
        Math.round(hour_hand_radius * Math.cos(hours_theta) + center_point[0]),
        Math.round(hour_hand_radius * Math.sin(hours_theta) + center_point[1])];

      var circle_points = get_bresenham_circle_points(center_point[0], center_point[1], clock_radius);
      var second_hand_points = get_bresenham_line_points([center_point, second_hand_end_point]);
      var minute_hand_points = get_bresenham_line_points([center_point, minute_hand_end_point]);
      var hour_hand_points = get_bresenham_line_points([center_point, hour_hand_end_point]);
      var shapes = [circle_points, second_hand_points, minute_hand_points, hour_hand_points];

      var text = (" ".repeat(columns) + "\n").repeat(rows);
      canvas.text(text);
      for (var i = 0; i < shapes.length; i++) {
        var shape_points = shapes[i];
        for (var j = 0; j < shape_points.length; j++) {
          var point = shape_points[j];
          setHalfPixel(canvas, point[0], point[1]);
        }
      }
      setTimeout(this_animation.bind(null, this_animation), 333);
    }, 2);

  /*----------- Random/Seed init -----------*/
  var animation_index;
  var animation_url_param = getUrlParameter("a");
  var parsed = parseInt(animation_url_param, 10);
  if (!isNaN(parsed)) animation_index = parsed;
  if (animation_index === 0 || !!animation_index) {
    if (animation_index >= animations.size()) {
      Math.seedrandom(animation_index);
      animation_index = null;
    }
  } else if (!!animation_url_param) {
    Math.seedrandom(animation_url_param);
  }

  var constant_random_boolean = Math.random() < 0.5;
  var constant_random_values = [];
  for (var i = 0; i < 10; i++) {
    constant_random_values.push(Math.random());
  }

  var animation = animation_index === 0 ? animations.get_index(0) :
    (animation_index ? animations.get_index(animation_index) : animations.sample());

  $(document).ready(function() {
    reset_canvas();

    // website name will iterate seeds if an integer one is defined
    var brubsby = $("h1 > a:first").get()[0];
    var old_value = getUrlParameter("a");
    if (old_value) {
      var new_value = old_value;
      var parsed = parseInt(old_value, 10);
      if (!isNaN(parsed)) new_value = parsed + 1;
      brubsby.href = "?a=" + new_value;
    }

    setTimeout(animation.bind(null, animation), 200);
  });

  var reset_canvas = function() {
      canvas = $(".ascii");
      var width = canvas.width();
      var height = canvas.height();

      rows = Math.max(1, Math.floor(height / char_height));
      columns = Math.max(1, Math.floor(width / char_width));
      animation_speed_multiplier = Math.max(1, Math.floor(rows * columns / 750));
      max_dim = Math.max(1, Math.max(rows, columns));
      min_dim = Math.max(1, Math.min(rows, columns));
      var row_text = ".".repeat(columns);

      canvas.empty();
      for (var i = 0; i < rows; i++) {
        canvas.append(row_text + "\n");
      }
  }


  </script>
  </head>
  <body>
    <div class="container">
      <div class="menu">
        <h1><a href="">BRUBSBY</a></h1>
        <ol id="links">
          <li id="twitter"><a href="https://twitter.com/brubsby">TWITTER</a></li>
          <li id="art"><a href="https://twitter.com/search?q=(%23plottertwitter%20OR%20%23generative)%20(from%3Abrubsby)&src=typed_query">ART</a></li>
          <li id="support"><a href="https://ko-fi.com/brubsby">SUPPORT</a></li>
          <li id="inquiries"><a href="https://twitter.com/messages/compose?recipient_id=2402350662">INQUIRIES</a></li>
        </ol>
      </div>
      <div class="ascii"></div>
    </div>
  </body>
</html>
